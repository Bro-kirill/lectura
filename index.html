<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reading App</title>

<style>
  body {
    margin: 0;
    background: #0f0f14;
    color: #eaeaf0;
    font-family: system-ui, sans-serif;
    overflow: hidden;
  }

  header {
    display: flex;
    justify-content: center;
    gap: 16px;
    padding: 10px;
    background: #181826;
  }

  button {
    background: #2a2a44;
    color: white;
    border: none;
    padding: 8px 14px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
  }

  main {
    height: calc(100vh - 56px);
    overflow: auto;
    display: flex;
    justify-content: center;
    padding: 20px;
  }

  #viewer {
    position: relative;
  }

  canvas {
    background: white;
    border-radius: 10px;
    box-shadow: 0 10px 40px rgba(0,0,0,.6);
  }

  .textLayer {
    position: absolute;
    inset: 0;
    color: transparent;
    user-select: text;
  }

  .textLayer span {
    cursor: text;
  }

  .highlight {
    background: yellow;
    color: transparent;
  }
</style>
</head>

<body>

<header>
  <button id="prev">â—€</button>
  <span id="pageInfo">Loadingâ€¦</span>
  <button id="next">â–¶</button>
</header>

<main>
  <div id="viewer">
    <canvas id="pdfCanvas"></canvas>
    <div id="textLayer" class="textLayer"></div>
  </div>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<script>
const url = 'book.pdf';

pdfjsLib.GlobalWorkerOptions.workerSrc =
  'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

let pdfDoc = null;
let pageNum = 1;
const scale = 1.5;

const canvas = document.getElementById('pdfCanvas');
const ctx = canvas.getContext('2d');
const textLayerDiv = document.getElementById('textLayer');
const pageInfo = document.getElementById('pageInfo');

function renderPage(num) {
  pdfDoc.getPage(num).then(page => {
    const viewport = page.getViewport({ scale });

    canvas.width = viewport.width;
    canvas.height = viewport.height;

    document.getElementById('viewer').style.width = viewport.width + 'px';
    document.getElementById('viewer').style.height = viewport.height + 'px';

    page.render({
      canvasContext: ctx,
      viewport
    });

    textLayerDiv.innerHTML = '';
    textLayerDiv.style.width = viewport.width + 'px';
    textLayerDiv.style.height = viewport.height + 'px';

    page.getTextContent().then(textContent => {
      pdfjsLib.renderTextLayer({
        textContent,
        container: textLayerDiv,
        viewport,
        textDivs: []
      });
    });

    pageInfo.textContent = `Page ${pageNum} / ${pdfDoc.numPages}`;
  });
}

pdfjsLib.getDocument(url).promise.then(pdf => {
  pdfDoc = pdf;
  renderPage(pageNum);
});

document.getElementById('next').onclick = () => {
  if (pageNum < pdfDoc.numPages) {
    pageNum++;
    renderPage(pageNum);
  }
};

document.getElementById('prev').onclick = () => {
  if (pageNum > 1) {
    pageNum--;
    renderPage(pageNum);
  }
};

/* ðŸ”¥ DOUBLE CLICK HIGHLIGHT ðŸ”¥ */
textLayerDiv.addEventListener('dblclick', e => {
  if (e.target.tagName === 'SPAN') {
    e.target.classList.toggle('highlight');
  }
});
</script>

</body>
</html>
