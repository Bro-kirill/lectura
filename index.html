<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="UTF-8">
<title>Lector PDF amb Apunts</title>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#0f0f14;
  color:#eaeaf0;
}

header{
  display:flex;
  gap:10px;
  padding:10px;
  background:#181826;
  flex-wrap:wrap;
  justify-content:center;
}

button{
  background:#2a2a44;
  color:white;
  border:none;
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
}
button:hover{ background:#3b3b66; }

input[type=number]{
  width:60px;
  text-align:center;
  border-radius:6px;
  border:none;
  padding:4px;
}

#main{
  height:calc(100vh - 70px);
  overflow:auto;
  padding:10px;
}

/* üìò BOOK */
#bookView{ display:block; }

#viewer{
  display:flex;
  gap:10px;
  justify-content:center;
}

canvas{
  border-radius:8px;
  box-shadow:0 10px 40px rgba(0,0,0,.6);
}

/* üìù NOTES */
#notesView{
  display:none;
  max-width:900px;
  margin:auto;
}

#notesToolbar{
  display:flex;
  gap:10px;
  margin-bottom:10px;
  flex-wrap:wrap;
}

#notesEditor{
  background:#fff;
  color:#000;
  min-height:80vh;
  padding:20px;
  border-radius:10px;
  outline:none;
  font-size:16px;
  line-height:1.6;
}

/* Progress */
.progressContainer{
  width:80%;
  height:8px;
  background:#333;
  border-radius:4px;
  margin:10px auto;
}
.progressBar{
  height:100%;
  background:#7f5af0;
  width:0%;
  border-radius:4px;
}
</style>
</head>
<body>

<header>
  <button id="toggleMode">üìù Entrar als apunts</button>

  <button id="start">‚èÆ Inici</button>
  <button id="prev">‚óÄ Anterior</button>
  <input type="number" id="pageInput" min="1">
  <button id="next">Seg√ºent ‚ñ∂</button>
  <button id="end">Final ‚è≠</button>

  <button id="doubleToggle">Mode doble DESACTIVAT</button>
</header>

<div id="main">

  <!-- üìò BOOK -->
  <div id="bookView">
    <div id="viewer">
      <canvas id="c1"></canvas>
      <canvas id="c2" style="display:none"></canvas>
    </div>

    <div class="progressContainer">
      <div class="progressBar" id="progress"></div>
    </div>
  </div>

  <!-- üìù NOTES -->
  <div id="notesView">

    <div id="notesToolbar">
      <button onclick="format('bold')"><b>B</b></button>
      <input type="color" id="colorPicker" title="Color del text">

    </div>

    <div id="notesEditor" contenteditable="true">
      <h2>Apunts</h2>
      <p>Escriu aqu√≠ tot el que vulguis ‚úçÔ∏è</p>
    </div>

  </div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

const url='book.pdf';
let pdfDoc,page=Number(localStorage.getItem('lastPage'))||1;
let double=false;

const c1=document.getElementById('c1').getContext('2d');
const c2=document.getElementById('c2').getContext('2d');
const canvas1=c1.canvas;
const canvas2=c2.canvas;

const pageInput=document.getElementById('pageInput');
const progress=document.getElementById('progress');

/* üìò Render PDF */
function render(p){
  pdfDoc.getPage(p).then(pg=>{
    let vp=pg.getViewport({scale:1.5});
    canvas1.width=vp.width;
    canvas1.height=vp.height;
    pg.render({canvasContext:c1,viewport:vp});

    if(double && p<pdfDoc.numPages){
      pdfDoc.getPage(p+1).then(pg2=>{
        let vp2=pg2.getViewport({scale:1.5});
        canvas2.style.display='block';
        canvas2.width=vp2.width;
        canvas2.height=vp2.height;
        pg2.render({canvasContext:c2,viewport:vp2});
      });
    } else canvas2.style.display='none';

    pageInput.value=p;
    progress.style.width=(p/pdfDoc.numPages*100)+'%';
    localStorage.setItem('lastPage',p);
  });
}

/* Navigation */
next.onclick=()=>{ if(page<pdfDoc.numPages){ page+=double?2:1; render(page);} }
prev.onclick=()=>{ if(page>1){ page-=double?2:1; render(page);} }
start.onclick=()=>{ page=1; render(page); }
end.onclick=()=>{ page=pdfDoc.numPages; render(page); }

pageInput.onchange=()=>{
  let v=+pageInput.value;
  if(v>=1 && v<=pdfDoc.numPages){ page=v; render(page); }
};

doubleToggle.onclick=()=>{
  double=!double;
  doubleToggle.textContent=`Mode doble ${double?'ACTIVAT':'DESACTIVAT'}`;
  render(page);
};

/* üîÅ Toggle book / notes */
const bookView=document.getElementById('bookView');
const notesView=document.getElementById('notesView');
const toggle=document.getElementById('toggleMode');

toggle.onclick=()=>{
  if(bookView.style.display!=='none'){
    bookView.style.display='none';
    notesView.style.display='block';
    toggle.textContent='üìò Entrar al llibre';
  }else{
    notesView.style.display='none';
    bookView.style.display='block';
    toggle.textContent='üìù Entrar als apunts';
  }
};

/* üìù Formatting */
function format(cmd){
  document.execCommand(cmd,false,null);
}

colorPicker.oninput=e=>{
  document.execCommand('foreColor',false,e.target.value);
};



/* Load PDF */
pdfjsLib.getDocument(url).promise.then(pdf=>{
  pdfDoc=pdf;
  render(page);
});
</script>
</body>
</html>
