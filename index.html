<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PDF Reader - Double Page Mode</title>

<style>
  body { margin:0; font-family:system-ui; background:#0f0f14; color:#eaeaf0; overflow:auto; }
  header { display:flex; justify-content:center; gap:10px; padding:10px; background:#181826; flex-wrap:wrap; }
  header input[type=number]{ width:60px; padding:4px; border-radius:6px; border:none; text-align:center;}
  button{ background:#2a2a44; color:white; border:none; padding:6px 12px; border-radius:6px; cursor:pointer;}
  button:hover{ background:#3b3b66;}
  #main{ display:flex; justify-content:center; align-items:flex-start; height:calc(100vh-70px); overflow:auto; padding:10px;}
  #viewer{ position:relative; display:flex; gap:10px; }
  canvas{ display:block; border-radius:8px; box-shadow:0 10px 40px rgba(0,0,0,.6);}
  .progressContainer{ width:80%; height:8px; background:#333; border-radius:4px; margin-top:5px; }
  .progressBar{ height:100%; background:#7f5af0; width:0%; border-radius:4px;}
</style>
</head>
<body>

<header>
  <button id="start">⏮ Start</button>
  <button id="prev">◀</button>
  <input type="number" id="pageNumInput" min="1" value="1">
  <button id="next">▶</button>
  <button id="end">⏭ End</button>
  <button id="doublePageToggle">Double Page OFF</button>
  <button id="themeDark">Dark</button>
  <button id="themeSepia">Sepia</button>
</header>

<div id="main">
  <div id="viewer">
    <canvas id="pdfCanvas"></canvas>
    <canvas id="pdfCanvas2" style="display:none;"></canvas>
    <div class="progressContainer">
      <div class="progressBar" id="progressBar"></div>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
const url='book.pdf';
pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

let pdfDoc=null, pageNum=Number(localStorage.getItem('lastPage'))||1;
const scale=1.5;
const canvas=document.getElementById('pdfCanvas');
const ctx=canvas.getContext('2d');
const canvas2=document.getElementById('pdfCanvas2');
const ctx2=canvas2.getContext('2d');
const pageNumInput=document.getElementById('pageNumInput');
const progressBar=document.getElementById('progressBar');

let doublePage=false;
const audio = new Audio('https://freesound.org/data/previews/522/522432_1079972-lq.mp3');

// Render Page (or double-page)
function renderPage(num){
  pdfDoc.getPage(num).then(page=>{
    const viewport=page.getViewport({scale});
    canvas.width=viewport.width;
    canvas.height=viewport.height;
    canvas.style.display='block';
    ctx.clearRect(0,0,canvas.width,canvas.height);
    page.render({canvasContext:ctx,viewport:viewport});
    
    // second page for double-page mode
    if(doublePage && num<pdfDoc.numPages){
      canvas2.style.display='block';
      pdfDoc.getPage(num+1).then(page2=>{
        const vp2=page2.getViewport({scale});
        canvas2.width=vp2.width;
        canvas2.height=vp2.height;
        ctx2.clearRect(0,0,canvas2.width,canvas2.height);
        page2.render({canvasContext:ctx2,viewport:vp2});
      });
    } else {
      canvas2.style.display='none';
    }

    pageNumInput.value=pageNum;
    progressBar.style.width=((pageNum/pdfDoc.numPages)*100)+'%';
    localStorage.setItem('lastPage',pageNum);
    audio.play();
  });
}

// Navigation functions
function nextPage(){ if(pageNum<pdfDoc.numPages){ pageNum+=doublePage?2:1; renderPage(pageNum); } }
function prevPage(){ if(pageNum>1){ pageNum-=doublePage?2:1; if(pageNum<1) pageNum=1; renderPage(pageNum); } }
function startPage(){ pageNum=1; renderPage(pageNum); }
function endPage(){ pageNum=pdfDoc.numPages; renderPage(pageNum); }

// Keyboard navigation
document.addEventListener('keydown',e=>{
  if(e.key==='ArrowRight') nextPage();
  if(e.key==='ArrowLeft') prevPage();
});

// Input page jump
pageNumInput.addEventListener('change',e=>{
  let val=Number(pageNumInput.value);
  if(val>=1 && val<=pdfDoc.numPages){ pageNum=val; renderPage(pageNum); }
});

// Buttons
document.getElementById('next').onclick=nextPage;
document.getElementById('prev').onclick=prevPage;
document.getElementById('start').onclick=startPage;
document.getElementById('end').onclick=endPage;

// Double-page toggle
document.getElementById('doublePageToggle').onclick=()=>{
  doublePage=!doublePage;
  document.getElementById('doublePageToggle').textContent=`Double Page ${doublePage?'ON':'OFF'}`;
  renderPage(pageNum);
};

// Theme buttons
document.getElementById('themeDark').onclick=()=>{ document.body.style.background='#0f0f14'; };
document.getElementById('themeSepia').onclick=()=>{ document.body.style.background='#f4ecd8'; };

// Load PDF
pdfjsLib.getDocument(url).promise.then(pdf=>{
  pdfDoc=pdf;
  renderPage(pageNum);
});
</script>
</body>
</html>
